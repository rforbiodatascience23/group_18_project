---
title: "04_augment.qmd"
format: html
editor: visual
---

# Load libraries

```{r}
library(purrr)
```

# Load clean data

```{r}
# NEW - from tsv file
clean_data1 <- read_tsv(
  file = "~/group_18_project/data/02_dat_clean1.tsv",
  show_col_types = FALSE)
```

# Augment

Make new columns cancer_organ and cancer_stage from cancer_type, removing the later afterwards

```{r}

## cancer_type is separated into new variables and then removed 
clean_hc_patient_data <- clean_hc_patient_data |>
  mutate(
    cancer_organ = case_when(
      grepl("prostate", tolower(cancer_type)) & grepl("bladder", tolower(cancer_type)) ~       "prostate,bladder",
      grepl("prostate", tolower(cancer_type)) ~ "prostate",
      grepl("bladder", tolower(cancer_type)) ~ "bladder",
      TRUE ~ NA_character_),
    cancer_stage = str_extract(cancer_type, "(?i)T\\d++[a-z]|Gleason \\d+")) |>
  select(-cancer_type)
```

### Data Wrangling: BMI

Compute the Body Mass Index (BMI) using the Height and Weight columns. The BMI will be added in a new column named: 'BMI'.

```{r}
clean_data1<- clean_data1 |> 
  mutate(
    height_m = height_cm/100,
    BMI = weight_kg/(height_m^2)) |> # Calculate BMI
  select(-height_m) # Remove 'height_m'. No longer used.

```

### Data Wrangling: Comorbidities

Separating and counting the number of comorbidities presented bye each patient. The number is added in a new column named: 'num_comorbidities'.

If comorbidities appears like 'NA' a 0 is assigned to 'num_comorbidities'.

```{r}
clean_data1 <- clean_data1 |> 
  mutate(
    num_comorbidities = ifelse(is.na(comorbidities), 0, lengths(str_split(comorbidities, ','))
  ))

```

### Data Wrangling: Hospitalization complications

Comput the sum fo hopitalization complications and add is as a new columns called: " "

```{r}
# WRONG CODE
clean_data1 <- replace(clean_data1:hospitalization_complications, c(', and', ' and '), ',')

print(clean_data1 |> select(hospitalization_complications))

```
